import FWCore.ParameterSet.Config as cms

process = cms.Process("AnalysisProc")
process.load("FWCore.MessageService.MessageLogger_cfi")
process.MessageLogger.cerr.FwkReport.reportEvery = 10000

import PhysicsTools.PythonAnalysis.LumiList as LumiList
LumiList.LumiList().getVLuminosityBlockRange()

process.source = cms.Source("PoolSource", fileNames =  cms.untracked.vstring('') )
from RecoJets.JetProducers.PileupJetIDParams_cfi import cutbased as pu_jetid


###### Electron VID
from RecoEgamma.ElectronIdentification.Identification.cutBasedElectronID_Spring15_25ns_V1_cff import *

if hasattr(cutBasedElectronID_Spring15_25ns_V1_standalone_loose,'isPOGApproved'):
    del cutBasedElectronID_Spring15_25ns_V1_standalone_loose.isPOGApproved
if hasattr(cutBasedElectronID_Spring15_25ns_V1_standalone_medium,'isPOGApproved'):
    del cutBasedElectronID_Spring15_25ns_V1_standalone_medium.isPOGApproved
if hasattr(cutBasedElectronID_Spring15_25ns_V1_standalone_tight,'isPOGApproved'):
    del cutBasedElectronID_Spring15_25ns_V1_standalone_tight.isPOGApproved

myVidElectronId = cms.PSet(
    loose = cutBasedElectronID_Spring15_25ns_V1_standalone_loose,
    medium = cutBasedElectronID_Spring15_25ns_V1_standalone_medium,
    tight = cutBasedElectronID_Spring15_25ns_V1_standalone_tight
)
#######

#from UserCode.llvv_fwk.mvaConfig_cfi import ewkzp2jFullNoQG as mySignalMVA
from UserCode.llvv_fwk.mvaConfig_cfi import ewkzp2jFull as mySignalMVA
#from UserCode.llvv_fwk.mvaConfig_cfi import ewkzp2jBase as mySignalMVA

datapileup_70300_2012abcd=cms.vdouble(8.09479e-06,5.64253e-05,0.000234438,0.000708129,0.0017105,0.00349358,0.00625553,0.0100708,0.0148505,0.020349,0.0262113,0.0320441,0.0374847,0.0422506,0.0461603,0.0491294,0.0511502,0.0522664,0.0525496,0.0520821,0.0509474,0.0492268,0.0469996,0.0443453,0.0413455,0.0380853,0.0346522,0.0311346,0.0276184,0.0241833,0.0208995,0.0178247,0.0150024,0.0124611,0.0102148,0.00826464,0.00660065,0.00520452,0.00405205,0.00311564,0.00236635,0.00177563,0.00131662,0.000964921,0.000699098,0.000500836,0.000354862,0.00024873,0.000172505,0.00011841,8.04614e-05,5.41399e-05,3.60823e-05,2.38255e-05,1.55917e-05,1.01156e-05,6.50871e-06,4.15502e-06,2.63279e-06,1.65666e-06,1.03577e-06,6.43829e-07,3.98156e-07,2.45158e-07,1.50427e-07,9.20683e-08,5.62672e-08,3.43759e-08,2.10198e-08,1.28799e-08,7.91828e-09,4.88962e-09,3.03584e-09,1.89664e-09,1.19296e-09,7.55627e-10,4.81954e-10,3.09438e-10,1.99876e-10,1.2979e-10,8.46506e-11,5.54024e-11,3.63523e-11,2.38919e-11,1.57154e-11,1.0338e-11,6.79661e-12,4.46326e-12,2.9262e-12,1.91457e-12,1.24969e-12,8.13541e-13,5.2808e-13,3.41728e-13,2.20422e-13,1.417e-13,9.07784e-14,5.79506e-14,3.68613e-14,2.33614e-14)

datapileup_70300_2012abcd_singleMu=cms.vdouble( 1.74887e-05, 8.41971e-05, 0.000287341, 0.000803268, 0.00187968, 0.00377078, 0.0066576, 0.0105832, 0.0154249, 0.0209121, 0.0266813, 0.0323481, 0.0375723, 0.0421003, 0.0457791, 0.0485477, 0.0504145, 0.0514311, 0.0516703, 0.0512103, 0.0501269, 0.0484915, 0.046373, 0.0438405, 0.0409668, 0.0378292, 0.0345099, 0.0310934, 0.0276634, 0.0242989, 0.0210703, 0.0180364, 0.015242, 0.0127175, 0.0104787, 0.00852824, 0.00685803, 0.00545122, 0.00428495, 0.00333277, 0.00256669, 0.00195893, 0.00148318, 0.00111545, 0.00083458, 0.000622389, 0.000463664, 0.000345947, 0.000259249, 0.000195714, 0.000149271, 0.000115306, 9.03708e-05, 7.19217e-05, 5.81115e-05, 4.76144e-05, 3.94894e-05, 3.30754e-05, 2.79112e-05, 2.36762e-05, 2.01478e-05, 1.71707e-05, 1.4635e-05, 1.24614e-05, 1.05913e-05, 8.97977e-06, 7.59119e-06, 6.39635e-06, 5.37056e-06, 4.49252e-06, 3.74351e-06, 3.10699e-06, 2.56822e-06, 2.1141e-06, 1.73297e-06, 1.4145e-06, 1.14958e-06, 9.30199e-07, 7.49367e-07, 6.01001e-07, 4.79843e-07, 3.81374e-07, 3.01728e-07, 2.37618e-07, 1.86267e-07, 1.45337e-07, 1.12875e-07, 8.72566e-08, 6.71403e-08, 5.1423e-08, 3.9204e-08, 2.97519e-08, 2.24765e-08, 1.69039e-08, 1.26565e-08, 9.43474e-09, 7.00267e-09, 5.17537e-09, 3.80882e-09, 2.79153e-09)


datapileup_200pb_2015bcd_ll_Preliminary = cms.vdouble(0, 169, 538, 1562, 3650, 7094, 11435, 16000, 19857, 21999, 22816, 22006, 19766, 17567, 14740, 12202, 10001, 8014, 6423, 4908, 3735, 2803, 2061, 1484, 1037, 688, 435, 293, 174, 117, 82, 39, 25, 14, 11, 5, 2, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  )


datapileup_40pb_2015b_singlemu_PietroPreliminary = cms.vdouble(0, 0.000810074, 0.000608754, 0.00108809, 0.00249253, 0.00551713, 0.0105118, 0.0185071, 0.0286402, 0.041285, 0.0545865, 0.066728, 0.0771487, 0.0843004, 0.0874832, 0.0865053, 0.0815586, 0.0744261, 0.0637849, 0.054203, 0.0435427, 0.0336157, 0.0249877, 0.0184448, 0.0129276, 0.00930386, 0.00608754, 0.00412227, 0.00258361, 0.00155783, 0.00104015, 0.000613547, 0.00038826, 0.000282807, 0.000139007, 8.14867e-05, 3.35533e-05, 3.35533e-05, 1.91733e-05, 4.79334e-06, 4.79334e-06, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

datapileup_42pb_2015b_singlemu_cleanNvtx_PietroPreliminary = cms.vdouble(0, 0.000520232, 0.000399503, 0.000812177, 0.00193605, 0.00449551, 0.00890321, 0.0160218, 0.0253465, 0.036965, 0.0495867, 0.0622983, 0.0730827, 0.082482, 0.0871882, 0.0879104, 0.0847583, 0.0780194, 0.0678628, 0.0582638, 0.0469855, 0.0370682, 0.0278972, 0.0199334, 0.0141692, 0.00980538, 0.00633717, 0.00422771, 0.00259896, 0.00165289, 0.000994367, 0.000557548, 0.000357797, 0.000237068, 0.000158045, 7.24374e-05, 3.73162e-05, 3.0731e-05, 1.53655e-05, 6.58521e-06, 4.39014e-06, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)

datapileup_42pb_2015C_singlemu_cleanNvtx_PietroPreliminary = cms.vdouble( 3.9990225e-05, 0.00064873031, 0.001959521, 0.0054431139, 0.011774899, 0.022367866, 0.038852725, 0.058638999, 0.079758281, 0.094741285, 0.10511208, 0.10750261, 0.10176179, 0.090711159, 0.07544378, 0.060140854, 0.045606629, 0.033391838, 0.023540912, 0.015938326, 0.010077537, 0.0066961409, 0.0040212393, 0.0024971674, 0.0015818356, 0.00084423808, 0.00040878896, 0.00025327142, 0.00013774411, 3.5546866e-05, 4.4433583e-05, 4.4433583e-06, 1.3330075e-05, 0, 0, 4.4433583e-06, 0, 4.4433583e-06, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 )

#datapileup_offIcial = cms.vdouble( 141899.9,    622421.5,    818662.3,    1253138,    2114164,    4937264,    1.627961e+07,    6.475337e+07,    1.817159e+08,    3.220406e+08,    4.16444e+08,    4.291912e+08,    3.663307e+08,    2.557795e+08,    1.447021e+08,    6.727821e+07,    2.736262e+07,    1.139197e+07,    5668287,    3025054,    1401679,    511811,    146735.4,    35294.85,    8269.747,    2235.301,    721.3224,    258.8397,    97.26937,    36.8714,    13.72746,    4.931709,    1.692407,    0.5518936,    0.1706013,    0.0499358,    0.01383391,    0.003626617,    0.0008996063,    0.0002111484,    4.689276e-05,    9.85392e-06,    1.959294e-06,    3.686198e-07,    6.562482e-08,    1.105342e-08,    1.762478e-09,    2.614969e-10,    4.768003e-11)

datapileup_official = cms.vdouble( 233315.9, 1104825, 1515017, 2292258, 
4100444, 9698595, 3.048471e+07, 1.176267e+08, 
3.190946e+08, 5.432384e+08, 7.097099e+08, 7.608101e+08, 
6.704816e+08, 4.766042e+08, 2.717604e+08, 1.264237e+08, 
5.114578e+07, 2.125045e+07, 1.071178e+07, 5812020, 
2715869, 990020.5, 278908.1, 63514.85, 
12947.54, 2673.577, 580.8423, 125.2505, 
25.31956, 4.688085, 0.7904239, 0.1212263, 
0.01690984, 0.002145242, 0.0002475142, 2.597198e-05, 
2.478306e-06, 2.150853e-07, 1.691376e-08, 1.057445e-09, 
2.614969e-10, 4.768003e-11, 4.768003e-11, 4.768003e-11, 
4.768003e-11, 4.768003e-11, 4.768003e-11, 4.768003e-11, 
4.768003e-11 )

# these values shape to the data,
# but the overall factor might be off
pileup_reweight_direct01 = cms.vdouble(
 1.113719e+02,  1.255670e+02,  1.018569e+02,  3.335962e+01,  2.019940e+01,
 3.871845e+00,  2.220242e+00,  2.744113e+00,  3.371923e+00,  3.128019e+00,
 2.925835e+00,  2.720456e+00,  2.227715e+00,  1.515275e+00,  8.552187e-01,
 4.005162e-01,  1.660502e-01,  7.088110e-02,  3.716012e-02,  2.161993e-02,
 1.146388e-02,  5.059794e-03,  1.846367e-03,  5.833035e-04,  1.756582e-04,
 5.761956e-05,  2.112002e-05,  8.285186e-06,  3.205277e-06,  1.191412e-06,
 3.768895e-07,  9.759932e-08,  1.934758e-08,  3.145019e-09,  4.257636e-10,
 5.380888e-11,  5.833354e-12,  5.927809e-13,  5.336206e-14,  4.047834e-15
)

# pileup for MC of CMSSW76 datasets
# 100 binx of nvtx
pileup_reweight_direct02 = cms.vdouble(
3.353685e+01, 4.542866e+01, 7.186306e+01, 9.461975e+01, 1.174475e+02, 1.466507e+02,
1.051103e+02, 8.871167e+01, 8.818208e+01, 8.288996e+01, 7.901034e+01, 7.647847e+01,
7.196641e+01, 6.248107e+01, 4.865460e+01, 3.439002e+01, 2.328535e+01, 1.732602e+01,
1.573152e+01, 1.407545e+01, 9.264466e+00, 4.224754e+00, 1.421449e+00, 3.849781e-01,
9.536659e-02, 2.419505e-02, 6.659890e-03, 1.863320e-03, 5.027413e-04, 1.294050e-04,
3.098729e-05, 7.002443e-06, 1.514269e-06, 3.033859e-07, 5.939866e-08, 9.894088e-09,
1.652204e-09, 2.569717e-10, 3.538444e-11, 4.020703e-12, 1.791075e-12, 5.886423e-13,
8.996232e-13, 1.589334e-12, 1.833847e-12, 4.334548e-12, 1.192001e-11, 6.811433e-12,
4.768003e-11, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15,
4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15,
4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15,
4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15,
4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15,
4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15,
4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15,
4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15,
4.047834e-15, 4.047834e-15, 4.047834e-15, 4.047834e-15
)

# devided by factor to have integral of reweighted result = 1
pileup_reweight_direct03 = cms.vdouble(
0.5112324695121951, 0.6925100609756099, 1.0954734756097562, 1.442374237804878, 1.7903582317073172, 2.2355289634146343, 1.6022911585365853,
1.352312042682927, 1.344239024390244, 1.2635664634146342, 1.2044259146341465, 1.1658303353658537, 1.0970489329268294, 0.9524553353658538,
0.7416859756097562, 0.5242381097560976, 0.3549596036585366, 0.2641161585365854, 0.239809756097561, 0.21456478658536587, 0.14122661585365856,
0.06440173780487805, 0.021668429878048782, 0.005868568597560976, 0.0014537589939024392, 0.0003688269817073171, 0.00010152271341463415,
2.840426829268293e-05, 7.663739329268294e-06, 1.9726371951219515e-06, 4.7236722560975613e-07, 1.0674455792682928e-07, 2.3083368902439027e-08,
4.624785060975611e-09, 9.054673780487806e-10, 1.5082451219512198e-10, 2.5186036585365855e-11, 3.9172515243902445e-12, 5.393969512195123e-13,
6.129120426829269e-14, 2.7302972560975612e-14, 8.973205792682927e-15, 1.3713768292682928e-14, 2.422765243902439e-14, 2.7954984756097567e-14,
6.607542682926829e-14, 1.8170746951219515e-13, 1.0383282012195124e-13, 7.268297256097562e-13, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17, 6.170478658536586e-17,
6.170478658536586e-17)


# devided by factor to have integral of reweighted result = 1
pileup_reweight_direct04 = cms.vdouble(6.170478658536586e-17, 1111.9857289717,  302.2890199345,  303.2321792876,
244.2063983405,   48.6995759569,   15.4016101319,    7.2350674299,    4.2205873194,
  2.6435440801,    1.9811728086,    1.6390520853,    1.3504305265,    1.0683110767,
  0.8270439647,    0.6201725093,    0.4527069295,    0.3194496657,    0.2196936748,
  0.1527332489,    0.1093541984,    0.0824484780,    0.0651818443,    0.0543547567,
  0.0482568918,    0.0448041649,    0.0444368882,    0.0456661187,    0.0506035316,
  0.0568668761,    0.0590789733,    0.0575602858,    0.0440957960,    0.0271126565,
  0.0160665213,    0.0099066642,    0.0067156806,    0.0038743418,    0.0019699420,
  0.0012634604,    0.0002456735,    0.0003451868,    6.170478658536586e-17,    6.170478658536586e-17,
  0.0002217059,    6.170478658536586e-17,    0.0013984539,    0.0030299876,    0.0060599815,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,  6.170478658536586e-17,
  6.170478658536586e-17)

# pileup 5, calculated from raw weight, on MC including QCD and gamma-jets
pileup_reweight_direct05 = cms.vdouble(0.000000001,  4.220088460,  4.598039608, 13.652692271, 25.378187011, 
28.041366638, 11.019616135,  3.555083168,  1.682959219,  1.069098236,  0.813662608,
 0.701956295,  0.664941369,  0.672218589,  0.719223353,  0.811839758,  0.969054194,
 1.186320186,  1.416493911,  1.513006793,  1.350690827,  1.047971859,  0.760579439,
 0.548303083,  0.397083474,  0.289620610,  0.212893474,  0.159178002,  0.119958115,
 0.092749047,  0.073594988,  0.060668709,  0.049034700,  0.041458454,  0.033568514,
 0.029505623,  0.029875491,  0.023435224,  0.019287476,  0.019579458,  0.005551361,
 0.013100046,  0.000000001,  0.000000001,  0.015082070,  0.000000001,  0.040719093,
 0.034111533, 24.006541795,  0.000000001,  0.000000001,  0.000000001,  0.000000001,
 0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,
 0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,
 0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,
 0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,
 0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,
 0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,
 0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001,
 0.000000001,  0.000000001,  0.000000001,  0.000000001,  0.000000001 )

# pileup 6, calculated from physics validation group for nominal (69000), up (*1.05) and down (*0.95)
# integra (sum) normalized to 1 and ratio to normalized sum of all MC is taken (check per-MC!)
pileup_reweight_direct06 = cms.vdouble(
0.541017648373338655, 0.690098617140731285, 1.150515333100299520, 1.441495411025408346,
 1.786256405118777479, 2.219837789345259882, 1.582209240167116171, 1.335917816225765664,
 1.342317293317693228, 1.259808602523545540, 1.191169832765620606, 1.154919632669142882,
 1.096434299223810527, 0.959965382788056876, 0.757564802723994513, 0.543232105337657978,
 0.374120324484414069, 0.277697673724766780, 0.246111276066691420, 0.215271135742257536,
 0.140464925726666134, 0.063781849702450599, 0.021706169201982515, 0.006236048361509947,
 0.001776436541920155, 0.000592091177018905, 0.000239838067989624, 0.000112186371028485,
 0.000056130120941213, 0.000029435376127891, 0.000015778955378778, 0.000008457111179473,
 0.000004412354357798, 0.000002311966048312, 0.000001214061861782, 0.000000537024749749,
 0.000000278523004113, 0.000000116064227059, 0.000000052855603191, 0.000000024524948689,
 0.000000009280953196, 0.000000004625103605, 0.000000001624006295, 0.000000000763788030,
 0.000000000107321059, 0.000000000045966688, 0.000000000007710744, 0.000000000000952532,
 0.000000000000952532,                  0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0,
                   0,                   0,                  0,                  0)

pileup_reweight_direct06_up = cms.vdouble(
0.4563260300339851, 0.6255957400206295, 1.0651753091957377, 1.2795023333505058, 1.4657402549206846,
 1.6331421899968488, 1.0164443920616635, 0.7854421907015098, 0.9078668014335758, 0.9869944012653512,
 1.0235549676048885, 1.0818323139165800, 1.1487330748042766, 1.1605804959986954, 1.0787481092617033,
 0.9153185887075188, 0.7213745385831798, 0.5446501580123898, 0.4322431513495962, 0.3696665010814371,
 0.2846977295468996, 0.1697222836586575, 0.0778651959774333, 0.0288028578999414, 0.0091476162670671,
 0.0028032135282622, 0.0009719991655568, 0.0004141709657928, 0.0002027092998572, 0.0001091853572999,
 0.0000624298194741, 0.0000367409359338, 0.0000214795693848, 0.0000127845790503, 0.0000076987693343,
 0.0000039336063762, 0.0000023709177965, 0.0000011545663989, 0.0000006176977982, 0.0000003384628439,
 0.0000001520359661, 0.0000000903961858, 0.0000000380638006, 0.0000000215781761, 0.0000000036732140,
 0.0000000019160192, 0.0000000003932517, 0.0000000000607453, 0.0000000000607453, 0.0000000000607453,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0,
                0,                0,                0,                0,                0)

pileup_reweight_direct06_down = cms.vdouble(
  0.63284164128966746699, 0.76256637723113152028, 1.25851044490964669720, 1.65459004325738212593,
  2.25198278900848691819, 3.17823376642643973256, 2.66185433679874794421, 2.24221194749490049247,
  1.87417321693176153197, 1.54708892905301520493, 1.33261504007238418268, 1.15886330596350362043,
  0.95115151392680541420, 0.69947482060218069133, 0.45809349445781943899, 0.27901832573875073873,
  0.18285905200059190956, 0.15155638200616536326, 0.13974866639108612931, 0.10248647943588752585,
  0.04951471796494383293, 0.01619852861530052257, 0.00423056750693087159, 0.00111873271439704206,
  0.00036099994306258021, 0.00014118486124048153, 0.00006163830072936450, 0.00002889370086400587,
  0.00001377220943904483, 0.00000661536398062533, 0.00000315721247935390, 0.00000147830142207315,
  0.00000066531990130792, 0.00000029798197016822, 0.00000013276811507444, 0.00000004950462578255,
  0.00000002150910687586, 0.00000000746358219851, 0.00000000281340462333, 0.00000000107413323734,
  0.00000000033248515161, 0.00000000013472725944, 0.00000000003823673456, 0.00000000001445252627,
  0.00000000000162571750, 0.00000000000055372785, 0.00000000000006982589, 0.00000000000000000000,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0,
                       0,                      0,                      0,                      0)


pileup2016_direct = cms.vdouble(
0.0001963997, 0.0099803283, 0.0140393847, 0.0236650192, 0.0393018959, 0.0309978672, 0.0335953171, 0.0693976520, 0.1645644073, 0.3172568412, 0.4958772343,
0.7212457135, 0.9722619718, 1.1588673286, 1.2629741307, 1.2206370438, 1.1412999298, 1.2127949022, 1.1814431982, 1.2755529410, 1.1356762690, 1.0576495063,
1.0698530227, 1.1106773694, 1.0700410962, 1.1490349905, 1.0178461013, 1.0042396010, 0.8374938723, 0.7532931817, 0.6394506673, 0.5333444236, 0.5741482254,
0.5579844927, 0.7467029777, 1.1796475320, 2.4277076607, 3.2817940991, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000, 0.0000000000,
0.0000000000)



from os import path as path

theLumiMask = path.expandvars("{lumiMask}")

runProcess = cms.PSet(
    dtag  = cms.string("{dtag}"),
    job_num  = cms.string("{job_num}"),
    input = cms.untracked.vstring({input}),
    outfile = cms.string("{outfile}"),
    outdir = cms.string("{outdir}"),
    isMC = cms.bool({isMC}),
    withTauIDSFs = cms.bool({withTauIDSFs}),
    #triggerstudy = cms.bool(@trig),
    triggerstudy = cms.bool(False),
    #xsec = cms.double(@xsec),
    xsec = cms.double(1.0),
    #suffix = cms.string("@suffix"), 
    suffix = cms.string(""), 
    #cprime = cms.double(@cprime),	
    #brnew = cms.double(@brnew),	
    cprime = cms.double(-1),      # 111
    brnew = cms.double(-1),	  # 111
    #mctruthmode = cms.int32(@mctruthmode),
    mctruthmode = cms.int32(0),
    #jacknife = cms.vint32(@jacknife,@jacks),
    #saveSummaryTree = cms.bool(@saveSummaryTree),
    #runSystematics = cms.bool(@runSystematics),
    jacknife = cms.vint32(-1,-1), # 111
    saveSummaryTree = cms.bool(False),
    runSystematics = cms.bool(False),
    #weightsFile = cms.vstring("@weightsFile"),
    weightsFile = cms.vstring(""),
    dirName = cms.string("dataAnalyzer"),
    #useMVA = cms.bool(@useMVA),
    useMVA = cms.bool(False),
    tmvaInput = mySignalMVA,
    muscleDir =  cms.string('${{CMSSW_BASE}}/src/UserCode/llvv_fwk/data/jec/'),
    jecDir = cms.string('${{CMSSW_BASE}}/src/UserCode/llvv_fwk/data/jec/25ns/'),
    resolutionFile =  cms.string('${{CMSSW_BASE}}/src/UserCode/llvv_fwk/data/jec/25ns/Spring16_25nsV10_MC_PtResolution_AK4PFchs.txt'),
    scaleFactorFile = cms.string('${{CMSSW_BASE}}/src/UserCode/llvv_fwk/data/jec/25ns/Spring16_25nsV10_MC_SF_AK4PFchs.txt'),
    dataDriven_tauFakeRates1 = cms.string('${{CMSSW_BASE}}/src/UserCode/llvv_fwk/bin/ttbar-leptons-80X/jet_to_tau_fakerates1.root'),
    dataDriven_tauFakeRates2 = cms.string('${{CMSSW_BASE}}/src/UserCode/llvv_fwk/bin/ttbar-leptons-80X/jet_to_tau_fakerates2.root'),
    dataDriven_tauFakeRates_dileptons = cms.string('${{CMSSW_BASE}}/src/UserCode/llvv_fwk/bin/ttbar-leptons-80X/jet_to_tau_fakerates_dileptons.root'),
    tau_fake_rate_histo1_fraction = cms.double(0.5),
    #muscleDir =  cms.string('{{project_dir}}/src/UserCode/llvv_fwk/data/jec/'),
    #jecDir = cms.string('{{project_dir}}/src/UserCode/llvv_fwk/data/jec/25ns/'),
    #pileup_reweight_direct = pileup_reweight_direct04,
    #pileup_reweight_direct = pileup_reweight_direct05,
    pileup_reweight_direct = pileup2016_direct,
    pileup_reweight_direct_down = pileup_reweight_direct06_down,
    pileup_reweight_direct_up = pileup_reweight_direct06_up,
    datapileup = datapileup_official, 
    datapileupSingleLep = datapileup_official,
    debug = cms.bool(False),
    debug_len = cms.int32(100),
    lumisToProcess = LumiList.LumiList(filename = theLumiMask).getVLuminosityBlockRange(),
    pujetidparas = cms.PSet(pu_jetid),
    electronidparas = cms.PSet(myVidElectronId),
    maxevents = cms.int32(-1) # set to -1 when running on grid. 
)


#STUFF BELLOW IS RUN ONLY IF CRAB IS USED
def lfn_to_pfn(f):
    import subprocess
    proc = subprocess.Popen(["edmFileUtil -d %s" %f],
                            stdout=subprocess.PIPE, shell=True)
    (out, err) = proc.communicate()
    pfn = out.strip()
    return pfn


try:
    import PSet
    fnames = [ lfn_to_pfn(f) for f in list(PSet.process.source.fileNames)]    
    inputFilesPfn =  cms.untracked.vstring(fnames)                
    print inputFilesPfn
    runProcess.input = inputFilesPfn
    runProcess.outfile = cms.string("output.root")
    process.source.fileNames = PSet.process.source.fileNames
except:
    pass
